parameters:
  publicSourceBranch: null

steps:
- powershell: |
    # If a imageInfoVersionsPath AzDO variable has already been set, use it. 
    if ($env:IMAGEINFOVERSIONSPATH) {
        return
    }

    if ("$(System.TeamProject)" -eq "$(publicProjectName)") {
        $basePath = "$(gitHubVersionsRepoInfo.path)"
    }
    else {
        $basePath= "$(azdoVersionsRepoInfo.path)"
    }

    $publicSourceBranch = "${{ parameters.publicSourceBranch }}"

    if ($publicSourceBranch -eq "") {
        throw "publicSourceBranch variable is not set"
    }

    $buildRepoName = "$(Build.Repository.Name)".Replace("/", "-")
    $imageInfoVersionsPath = "$basePath/image-info.$buildRepoName-$publicSourceBranch$(imageInfoVariant).json"

    echo "##vso[task.setvariable variable=imageInfoVersionsPath]$imageInfoVersionsPath"
  displayName: Set Image Info Path Var
